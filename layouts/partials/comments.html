{{ if and (not .Params.disableComments) site.Params.giscus.repo }}
<!-- Giscus Comments -->
<script src="https://giscus.app/client.js"
        data-repo="{{ site.Params.giscus.repo }}"
        data-repo-id="{{ site.Params.giscus.repoId }}"
        data-category="{{ site.Params.giscus.category }}"
        data-category-id="{{ site.Params.giscus.categoryId }}"
        data-mapping="{{ site.Params.giscus.mapping }}"
        data-strict="{{ site.Params.giscus.strict }}"
        data-reactions-enabled="{{ site.Params.giscus.reactionsEnabled }}"
        data-emit-metadata="{{ site.Params.giscus.emitMetadata }}"
        data-input-position="{{ site.Params.giscus.inputPosition }}"
        data-theme="{{ site.Params.giscus.theme }}"
        data-lang="{{ site.Params.giscus.lang }}"
        data-loading="lazy"
        crossorigin="anonymous"
        async>
</script>

<!-- Giscus スキン切り替え -->
<script>
    // スキン切り替えに合わせてGiscusのテーマも変更
    const giscusThemes = {
        'light_white': 'light',
        'furvous': 'dark',
        'reading': 'light'
    };

    document.getElementById('skin-toggle').addEventListener('click', function() {
        const currentSkin = localStorage.getItem('skin') || '0';
        const skinIndex = parseInt(currentSkin) % 3;
        const theme = giscusThemes[skinIndex];

        const iframe = document.querySelector('iframe.giscus-frame');
        if (iframe) {
            iframe.contentWindow.postMessage({
                giscus: {
                    setConfig: {
                        theme: theme
                    }
                }
            }, 'https://giscus.app');
        }
    });
</script>
{{ end }}
