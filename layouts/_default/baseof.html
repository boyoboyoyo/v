<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="referrer" content="origin-when-cross-origin" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>{{ .Title }} - {{ site.Title }}</title>
    <link rel="icon" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMTYiIGN5PSIxNiIgcj0iMTYiIGZpbGw9IiM3Mzk2YTciLz4KPHR0ZXh0IHg9IjE2IiB5PSIyMSIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjE0IiBmb250LXdlaWdodD0iYm9sZCIgZmlsbD0id2hpdGUiIHRleHQtYW5jaG9yPSJtaWRkbGUiPlQ8L3RleHQ+Cjwvc3ZnPgo=" type="image/svg+xml" />

    <!-- APlayer CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ "css/style.css" | relURL }}">

    <!-- jQuery & APlayer -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.js"></script>

    <!-- MathJax -->
    {{ if .Params.mathjax | or site.Params.mathjax }}
    <script>
    window.MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']],
        displayMath: [['$$', '$$'], ['\\[', '\\]']],
        tags: 'ams',
        labelUrls: 'no',
        tagSide: 'right',
        tagIndent: '0.8em'
      },
      options: {
        ignoreHtmlClass: 'tex2jax_ignore',
        processHtmlClass: 'tex2jax_process'
      },
      svg: {
        fontCache: 'global'
      }
    };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    {{ end }}
</head>

<body>
    <div id="home">
        <!-- ヘッダー -->
        <div id="header">
            <div class="vertical">
                <h1><a id="Header1_HeaderTitle" href="{{ "/" | relURL }}">{{ site.Title }}</a></h1>
                <h2>{{ site.Params.description }}</h2>
            </div>
        </div>

        <!-- ナビゲーション -->
        <div id="navigator">
            <ul id="navList">
                <li><a href="{{ "/" | relURL }}">ホーム</a></li>
                <li><a href="{{ "/posts" | relURL }}">記事</a></li>
                <li><a href="{{ "/categories" | relURL }}">カテゴリ</a></li>
                <li><a href="{{ "/tags" | relURL }}">タグ</a></li>
                <li><a href="{{ "/about" | relURL }}">About</a></li>
            </ul>
        </div>

        <!-- メインコンテンツ -->
        <div id="main">
            {{ block "main" . }}{{ end }}
        </div>
        <div class="clear"></div>
    </div>

    <!-- フローティングコントロール -->
    <div class="floating-controls">
        <button id="skin-toggle" class="float-btn" title="スキン切り替え">Skin</button>
        <button id="music-toggle" class="float-btn" title="音楽プレイヤー">Music</button>
        <button id="back-to-top" class="float-btn" title="トップへ戻る">Top</button>
    </div>

    <!-- 音楽プレイヤー -->
    <div id="aplayer"></div>

    <!-- 魚アニメーションコンテナ -->
    <div id="jsi-flying-fish-container" class="container"></div>

    <!-- 星空エフェクト -->
    <script src="https://blog-static.cnblogs.com/files/miluluyo/three.min.js"></script>
    <script src="https://blog-static.cnblogs.com/files/miluluyo/star.js"></script>

    <!-- タップエフェクト -->
    <canvas width="1777" height="841" style="position: fixed; left: 0px; top: 0px; z-index: 2147483647; pointer-events: none;"></canvas>
    <script src="https://blog-static.cnblogs.com/files/miluluyo/mouse-click.js"></script>

    <!-- Scripts -->
    {{ block "scripts" . }}{{ end }}

    <!-- 共通スクリプト -->
    <script>
        $(document).ready(function() {
            console.log('Tech Blog - Hugo + cute-cnblogs2 Style');

            // ===== APlayer 音楽プレイヤー =====
            const ap = new APlayer({
                container: document.getElementById('aplayer'),
                fixed: true,
                autoplay: false,
                theme: '#7396a7',
                loop: 'all',
                order: 'random',
                preload: 'auto',
                volume: 0.5,
                mutex: true,
                listFolded: true,
                listMaxHeight: 120,
                audio: [
                    {
                        name: 'The Princess of Fake Moon Loop A',
                        artist: 'Unknown',
                        url: '{{ "siryou/The_Princess_of_Fake_Moon_Loop_A.mp3" | relURL }}',
                        cover: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTIwIiBoZWlnaHQ9IjEyMCIgdmlld0JveD0iMCAwIDEyMCAxMjAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxMjAiIGhlaWdodD0iMTIwIiBmaWxsPSIjNzM5NmE3Ii8+Cjx0ZXh0IHg9IjYwIiB5PSI3MCIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjI0IiBmb250LXdlaWdodD0iYm9sZCIgZmlsbD0id2hpdGUiIHRleHQtYW5jaG9yPSJtaWRkbGUiPm11c2ljPC90ZXh0Pgo8L3N2Zz4K'
                    }
                ]
            });

            // ===== 音楽コントロール =====
            let isPlaying = false;
            const tracks = [
                { name: 'The Princess of Fake Moon Loop A', artist: 'Unknown' }
            ];

            function updateTrackInfo() {
                $('#current-song').text(tracks[0].name);
                $('#current-artist').text(tracks[0].artist);
            }

            $('#play-pause-btn').click(function() {
                if (isPlaying) {
                    $(this).text('Play');
                    ap.pause();
                } else {
                    $(this).text('Pause');
                    ap.play();
                }
                isPlaying = !isPlaying;
            });

            ap.on('play', function() {
                $('#play-pause-btn').text('Pause');
                isPlaying = true;
            });

            ap.on('pause', function() {
                $('#play-pause-btn').text('Play');
                isPlaying = false;
            });

            // ===== スキン切り替え =====
            const skins = ['light_white', 'furvous', 'reading'];
            let currentSkin = parseInt(localStorage.getItem('skin')) || 0;

            function applySkin(skinIndex) {
                $('body').removeClass('skin-furvous skin-reading');
                if (skinIndex === 1) {
                    $('body').addClass('skin-furvous');
                } else if (skinIndex === 2) {
                    $('body').addClass('skin-reading');
                }

                // 魚アニメーションの切り替え
                $('#fish_script').remove();
                if (!isMobile()) {
                    const fishUrls = [
                        'https://blog-static.cnblogs.com/files/miluluyo/fish.js',
                        'https://blog-static.cnblogs.com/files/miluluyo/fish2.js',
                        'https://blog-static.cnblogs.com/files/miluluyo/fish3.js'
                    ];
                    const script = document.createElement('script');
                    script.type = 'text/javascript';
                    script.id = 'fish_script';
                    script.src = fishUrls[skinIndex];
                    document.body.appendChild(script);
                }
            }

            function isMobile() {
                const userAgent = navigator.userAgent;
                const mobileAgents = ["Android", "iPhone", "SymbianOS", "Windows Phone", "iPad", "iPod"];
                return mobileAgents.some(agent => userAgent.indexOf(agent) > 0);
            }

            // 初期スキン適用
            applySkin(currentSkin);

            $('#skin-toggle').click(function() {
                currentSkin = (currentSkin + 1) % skins.length;
                localStorage.setItem('skin', currentSkin);
                applySkin(currentSkin);
            });

            // ===== その他のコントロール =====
            $('#back-to-top').click(function() {
                $('html, body').animate({ scrollTop: 0 }, 600);
            });

            $('#music-toggle').click(function() {
                ap.toggle();
            });

            console.log('Hugo + cute-cnblogs2 style operational');
        });
    </script>
</body>
</html>
